# Example Deployment Repository

This directory demonstrates the required structure for a deployment repository that works with the GitOps orchestrator.

## Required Files

### 1. compose.yml
Your Docker Compose configuration defining all services.

### 2. .env
Environment variables for your docker-compose setup.

### 3. Makefile
**Critical:** This Makefile must be in your deployment repository. It defines the gitops targets that the orchestrator will call.

Required targets:
- `gitopsAll`: Full update of all services
- `gitops<ServiceName>`: Individual service updates (e.g., `gitopsLogstash`)

### 4. Service Directories (Optional)
Any subdirectory will be automatically detected as a service directory by the orchestrator. When files in a service directory change, the orchestrator will call the corresponding `gitops<ServiceName>` make target.

Example: If you have a `logstash/` directory, the orchestrator will:
- Monitor it for changes
- Call `make gitopsLogstash` when changes are detected

## Directory Structure

```
deployment-repo/
├── compose.yml              # Docker Compose configuration
├── .env                     # Environment variables
├── Makefile                 # Gitops targets (REQUIRED IN YOUR REPO)
├── .gitops_checksums.json   # Auto-generated by orchestrator (gitignored)
└── logstash/               # Service-specific configuration
    ├── pipeline/
    │   └── logstash.conf
    └── config/
        └── logstash.yml
```

## Usage

To use this example as a starting point:

1. Copy this directory to your desired location:
   ```bash
   cp -r examples/deployment-repo /path/to/my-deployment
   cd /path/to/my-deployment
   git init
   git add .
   git commit -m "Initial deployment setup"
   ```

2. Update `gitops-config.json` in the orchestrator:
   ```json
   {
       "targetDir": "/path/to/my-deployment"
   }
   ```

3. Customize:
   - Edit `compose.yml` with your services
   - Edit `.env` with your variables
   - Edit `Makefile` to add/modify service targets
   - Add service directories as needed

4. Run the orchestrator:
   ```bash
   cd /path/to/opsgit
   groovy gitops.groovy
   ```

## Important Notes

- **The Makefile must be in your deployment repository**, not in the orchestrator repository
- Service directories are **automatically detected** - you don't need to configure them anywhere
- Make target naming convention: `gitops` + capitalized service name (e.g., `gitopsMyservice`)
- Add `.gitops_checksums.json` to your `.gitignore` file
